/* ------------------------------------------------------------------------- */
/* ( 6 ) Testing PIG                                                         */
/* ------------------------------------------------------------------------- */
*filename cfg "&SAS_HADOOP_CONFIG_XML.";
filename out hadoop "/user/&USER./nyse.csv" debug /*cfg=cfg*/ user="&USER.";
data _null_;
	file out;

	length long $1024;
	input;
	long = _infile_;
	long = trim(long);
	put long ' ';

cards4;
exchange,stock_symbol,date,stock_price_open,stock_price_high,stock_price_low,stock_price_close,stock_volume,stock_price_adj_close
NYSE,ASP,2001-12-31,12.55,12.8,12.42,12.8,11300,6.91
NYSE,ASP,2001-12-28,12.5,12.55,12.42,12.55,4800,6.78
NYSE,ASP,2001-12-27,12.59,12.59,12.5,12.57,5400,6.79
NYSE,ASP,2001-12-26,12.45,12.6,12.45,12.55,5400,6.78
NYSE,ASP,2001-12-24,12.61,12.61,12.61,12.61,1400,6.76
NYSE,ASP,2001-12-21,12.4,12.78,12.4,12.6,18200,6.75
NYSE,ASP,2001-12-20,12.35,12.58,12.35,12.4,4200,6.65
NYSE,ASP,2001-12-19,12.42,12.6,12.35,12.6,10100,6.75
NYSE,ASP,2001-12-18,12.37,12.5,12.37,12.41,10100,6.65
NYSE,ASP,2001-12-17,12.4,12.52,12.4,12.52,8000,6.71
NYSE,ASP,2001-12-14,12.54,12.54,12.32,12.4,283000,6.65
NYSE,ASP,2001-12-13,12.4,12.55,12.4,12.54,13700,6.72
NYSE,ASP,2001-12-12,12.55,12.55,12.4,12.4,6900,6.65
NYSE,ASP,2001-12-11,12.6,12.6,12.45,12.55,8900,6.73
NYSE,ASP,2001-12-10,12.5,12.6,12.43,12.6,4400,6.75
NYSE,ASP,2001-12-07,12.6,12.65,12.43,12.6,9600,6.75
NYSE,ASP,2001-12-06,12.7,12.71,12.65,12.65,3400,6.78
NYSE,ASP,2001-12-05,12.63,12.81,12.45,12.7,15800,6.81
NYSE,ASP,2001-12-04,12.79,12.79,12.6,12.65,10800,6.78
NYSE,ASP,2001-12-03,12.72,12.79,12.65,12.79,8500,6.85
NYSE,ASP,2001-11-30,12.75,12.81,12.7,12.79,14600,6.8
NYSE,ASP,2001-11-29,12.7,12.82,12.7,12.82,3300,6.82
NYSE,ASP,2001-11-28,12.52,12.79,12.52,12.79,11100,6.8
NYSE,ASP,2001-11-27,12.53,12.6,12.42,12.42,12300,6.61
NYSE,ASP,2001-11-26,12.6,12.65,12.53,12.65,8200,6.73
NYSE,ASP,2001-11-23,12.5,12.5,12.5,12.5,3600,6.65
NYSE,ASP,2001-11-21,12.65,12.65,12.57,12.57,4400,6.69
NYSE,ASP,2001-11-20,12.65,12.65,12.63,12.65,2600,6.73
NYSE,AIT,2001-12-31,18.0,18.65,18.0,18.65,77400,6.94
NYSE,AIT,2001-12-28,18.4,18.66,17.9,17.9,51900,6.66
NYSE,AIT,2001-12-27,17.9,18.49,17.89,18.49,81300,6.88
NYSE,AIT,2001-12-26,17.4,18.6,17.4,17.9,102900,6.66
NYSE,AIT,2001-12-24,17.5,17.86,17.5,17.5,23100,6.51
NYSE,AIT,2001-12-21,17.6,18.0,17.6,17.7,147900,6.59
NYSE,AIT,2001-12-20,17.8,17.95,17.45,17.47,83700,6.5
NYSE,AIT,2001-12-19,18.15,18.15,17.75,17.85,50100,6.64
NYSE,AIT,2001-12-18,17.8,18.15,17.8,18.15,56400,6.75
NYSE,AIT,2001-12-17,18.0,18.08,16.76,17.7,232500,6.59
NYSE,AIT,2001-12-14,17.8,18.5,17.69,18.0,122100,6.7
NYSE,AIT,2001-12-13,18.0,18.5,17.8,17.8,70600,6.62
NYSE,AIT,2001-12-12,17.95,18.34,17.95,17.99,59000,6.69
NYSE,AIT,2001-12-11,18.67,18.67,17.4,17.8,117900,6.62
NYSE,AIT,2001-12-10,18.95,19.0,18.4,18.66,39900,6.94
NYSE,AIT,2001-12-07,19.4,19.45,18.35,18.99,92700,7.07
NYSE,AIT,2001-12-06,19.15,19.46,19.0,19.46,106200,7.24
NYSE,AIT,2001-12-05,18.85,19.35,18.85,19.2,60600,7.14
NYSE,AIT,2001-12-04,18.52,19.44,18.52,18.9,82400,7.03
NYSE,AIT,2001-12-03,18.31,18.51,18.2,18.5,238800,6.88
NYSE,AIT,2001-11-30,18.35,18.35,17.74,18.31,151800,6.81
NYSE,AIT,2001-11-29,18.25,18.4,18.0,18.4,36300,6.85
NYSE,AIT,2001-11-28,18.0,18.5,18.0,18.25,261000,6.79
NYSE,AIT,2001-11-27,17.6,18.26,17.55,18.18,69600,6.76
NYSE,AIT,2001-11-26,17.75,18.48,17.75,17.82,131000,6.63
NYSE,AIT,2001-11-23,18.0,18.03,17.75,17.75,94500,6.6
NYSE,AIT,2001-11-21,18.2,18.22,18.09,18.09,20700,6.73
NYSE,AIT,2001-11-20,18.4,18.52,18.2,18.2,68800,6.77
NYSE,AVA,2001-12-31,13.9,13.9,13.25,13.26,198500,10.12
NYSE,AVA,2001-12-28,13.6,13.85,13.31,13.79,143500,10.53
NYSE,AVA,2001-12-27,13.26,13.38,13.13,13.22,154000,10.09
NYSE,AVA,2001-12-26,12.91,13.41,12.91,13.35,112000,10.19
NYSE,AVA,2001-12-24,12.89,13.18,12.84,13.0,54600,9.93
NYSE,AVA,2001-12-21,12.75,13.19,12.55,13.19,279400,10.07
NYSE,AVA,2001-12-20,12.76,12.78,12.4,12.75,187700,9.73
NYSE,AVA,2001-12-19,12.0,12.8,11.99,12.77,294800,9.75
NYSE,AVA,2001-12-18,12.27,12.35,11.98,12.0,216600,9.16
NYSE,AVA,2001-12-17,12.85,12.85,12.25,12.34,298400,9.42
NYSE,AVA,2001-12-14,12.3,12.9,12.16,12.9,240600,9.85
NYSE,AVA,2001-12-13,12.14,12.2,12.01,12.16,166200,9.28
NYSE,AVA,2001-12-12,12.09,12.15,11.74,12.11,157300,9.25
NYSE,AVA,2001-12-11,11.95,12.01,11.68,12.0,544300,9.16
NYSE,AVA,2001-12-10,11.95,11.98,11.61,11.61,102300,8.86
NYSE,AVA,2001-12-07,11.85,12.15,11.83,12.15,207700,9.28
NYSE,AVA,2001-12-06,11.84,12.1,11.84,11.98,156900,9.15
NYSE,AVA,2001-12-05,11.9,12.0,11.64,11.84,275100,9.04
NYSE,AVA,2001-12-04,12.05,12.05,11.53,11.89,178600,9.08
NYSE,AVA,2001-12-03,11.95,12.1,11.7,12.05,97400,9.2
NYSE,AVA,2001-11-30,11.8,12.05,11.78,12.0,266900,9.16
NYSE,AVA,2001-11-29,11.9,11.95,11.7,11.85,135600,9.05
NYSE,AVA,2001-11-28,12.05,12.12,11.85,11.9,135000,9.09
NYSE,AVA,2001-11-27,11.9,12.32,11.75,12.21,201700,9.32
NYSE,AVA,2001-11-26,12.0,12.07,11.6,11.84,198200,9.04
NYSE,AVA,2001-11-23,11.86,12.05,11.66,11.97,35200,9.14
NYSE,AVA,2001-11-21,11.82,12.0,11.51,11.86,119800,9.05
NYSE,AVA,2001-11-20,12.02,12.1,11.7,11.73,280900,8.96
NYSE,AEG,2001-12-31,26.62,26.82,26.55,26.77,108600,19.5
NYSE,AEG,2001-12-28,26.55,26.73,26.45,26.7,204000,19.45
NYSE,AEG,2001-12-27,25.88,26.5,25.88,26.35,261900,19.19
NYSE,AEG,2001-12-26,25.4,26.4,25.33,26.25,268000,19.12
NYSE,AEG,2001-12-24,25.6,25.95,25.36,25.65,110900,18.68
NYSE,AEG,2001-12-21,25.31,26.49,25.31,26.1,253700,19.01
NYSE,AEG,2001-12-20,25.46,25.7,25.28,25.56,194000,18.62
NYSE,AEG,2001-12-19,25.72,26.14,25.49,25.95,136000,18.9
NYSE,AEG,2001-12-18,26.16,26.25,25.85,25.89,232100,18.86
NYSE,AEG,2001-12-17,26.46,27.11,26.46,26.92,574600,19.61
NYSE,AEG,2001-12-14,25.77,26.08,25.53,25.8,171200,18.79
NYSE,AEG,2001-12-13,25.83,26.07,24.7,25.44,215200,18.53
NYSE,AEG,2001-12-12,26.3,26.7,26.11,26.4,171000,19.23
NYSE,AEG,2001-12-11,26.1,26.41,25.9,26.18,112700,19.07
NYSE,AEG,2001-12-10,26.43,26.8,26.31,26.42,323600,19.24
NYSE,AEG,2001-12-07,27.13,27.48,27.11,27.26,107700,19.86
NYSE,AEG,2001-12-06,27.3,27.8,27.3,27.73,553400,20.2
NYSE,AEG,2001-12-05,26.33,26.94,26.33,26.82,358100,19.54
NYSE,AEG,2001-12-04,25.8,26.0,25.61,25.81,150800,18.8
NYSE,AEG,2001-12-03,25.94,26.75,25.81,26.21,157800,19.09
NYSE,AEG,2001-11-30,26.55,26.75,26.1,26.6,314500,19.38
NYSE,AEG,2001-11-29,26.35,26.4,26.01,26.34,182100,19.19
NYSE,AEG,2001-11-28,26.25,26.49,26.12,26.12,127200,19.03
NYSE,AEG,2001-11-27,26.52,26.61,26.1,26.49,230800,19.3
NYSE,AEG,2001-11-26,26.64,26.68,26.3,26.49,351500,19.3
NYSE,AEG,2001-11-23,26.62,26.74,26.31,26.61,276300,19.38
NYSE,AEG,2001-11-21,26.37,26.38,25.88,25.97,199200,18.92
NYSE,AEG,2001-11-20,26.43,26.49,26.07,26.29,186900,19.15
NYSE,ASF,2001-12-31,27.64,27.79,26.88,27.41,480700,25.32
NYSE,ASF,2001-12-28,27.0,28.55,27.0,27.54,542100,25.44
NYSE,ASF,2001-12-27,28.0,28.1,26.6,26.99,531600,24.93
NYSE,ASF,2001-12-26,28.85,28.85,27.9,28.0,527800,25.86
NYSE,ASF,2001-12-24,28.44,29.0,27.06,28.85,238400,26.65
NYSE,ASF,2001-12-21,28.45,28.7,27.45,28.44,409900,26.27
NYSE,ASF,2001-12-20,27.25,28.56,26.2,27.94,1344600,25.81
NYSE,ASF,2001-12-19,31.65,31.65,29.79,29.85,273700,27.57
NYSE,ASF,2001-12-18,31.4,32.1,31.4,31.75,150900,29.33
NYSE,ASF,2001-12-17,32.05,32.25,31.25,31.3,234800,28.91
NYSE,ASF,2001-12-14,32.25,32.4,31.1,32.3,179600,29.84
NYSE,ASF,2001-12-13,31.7,32.43,30.3,32.42,319100,29.95
NYSE,ASF,2001-12-12,32.35,32.84,31.7,31.82,426800,29.39
NYSE,ASF,2001-12-11,33.1,33.55,32.01,32.58,562100,30.09
NYSE,ASF,2001-12-10,33.1,36.48,32.95,34.55,707900,31.91
NYSE,ASF,2001-12-07,32.8,33.7,32.6,33.3,216900,30.76
NYSE,ASF,2001-12-06,30.75,33.8,30.75,33.5,534900,30.94
NYSE,ASF,2001-12-05,29.0,31.25,29.0,31.0,398800,28.63
NYSE,ASF,2001-12-04,28.18,29.3,28.15,28.53,197500,26.35
NYSE,ASF,2001-12-03,28.65,28.75,27.41,28.18,148700,26.03
NYSE,ASF,2001-11-30,27.45,29.5,27.43,29.18,243500,26.95
NYSE,ASF,2001-11-29,27.3,27.99,27.0,27.54,177900,25.44
NYSE,ASF,2001-11-28,28.0,28.58,26.53,27.08,196100,25.01
NYSE,ASF,2001-11-27,28.8,29.0,27.85,28.0,237600,25.86
NYSE,ASF,2001-11-26,30.05,30.05,28.2,28.67,364400,26.48
NYSE,ASF,2001-11-23,29.41,30.15,29.41,30.08,39500,27.78
NYSE,ASF,2001-11-21,29.7,29.8,28.6,29.16,239900,26.93
NYSE,ASF,2001-11-20,30.2,30.2,29.35,29.8,417700,27.53
NYSE,AMG,2001-12-31,70.05,70.74,69.8,70.48,219000,46.99
NYSE,AMG,2001-12-28,69.25,70.4,69.24,69.87,396800,46.58
NYSE,AMG,2001-12-27,69.49,69.8,68.25,69.07,308000,46.05
NYSE,AMG,2001-12-26,69.5,70.25,69.2,69.42,98200,46.28
NYSE,AMG,2001-12-24,69.41,69.76,69.2,69.34,45400,46.23
NYSE,AMG,2001-12-21,70.05,70.45,68.95,69.41,497400,46.27
NYSE,AMG,2001-12-20,70.05,70.75,69.49,69.8,299200,46.53
NYSE,AMG,2001-12-19,70.2,70.74,69.9,70.03,441300,46.69
NYSE,AMG,2001-12-18,70.0,70.65,69.55,70.19,2006600,46.79
NYSE,AMG,2001-12-17,71.1,73.25,71.1,73.1,422600,48.73
NYSE,AMG,2001-12-14,71.9,72.3,70.55,71.16,208200,47.44
NYSE,AMG,2001-12-13,71.35,72.45,70.9,72.0,196800,48.0
NYSE,AMG,2001-12-12,71.05,71.7,70.0,71.6,183400,47.73
NYSE,AMG,2001-12-11,71.46,71.85,70.41,70.8,218200,47.2
NYSE,AMG,2001-12-10,73.1,73.6,71.25,71.3,242800,47.53
NYSE,AMG,2001-12-07,72.25,73.7,72.2,73.34,509700,48.89
NYSE,AMG,2001-12-06,70.89,73.24,70.69,72.25,436500,48.17
NYSE,AMG,2001-12-05,68.25,71.0,68.25,70.99,341000,47.33
NYSE,AMG,2001-12-04,66.9,68.49,66.9,68.0,231300,45.33
NYSE,AMG,2001-12-03,67.6,67.6,66.0,66.65,320200,44.43
NYSE,AMG,2001-11-30,68.91,68.91,67.85,67.85,218100,45.23
NYSE,AMG,2001-11-29,66.86,69.25,65.95,69.16,289200,46.11
NYSE,AMG,2001-11-28,68.85,69.0,66.85,66.86,434800,44.57
NYSE,AMG,2001-11-27,70.12,70.25,68.55,68.85,214600,45.9
NYSE,AMG,2001-11-26,69.2,70.71,69.2,70.32,510200,46.88
NYSE,AMG,2001-11-23,68.44,69.45,68.44,69.15,60200,46.1
NYSE,AMG,2001-11-21,68.01,68.55,67.85,68.43,259600,45.62
NYSE,AMG,2001-11-20,68.81,69.39,67.8,67.9,261200,45.27
NYSE,ASA,2001-12-31,19.65,20.0,19.65,20.0,74500,16.84
NYSE,ASA,2001-12-28,20.2,20.2,19.61,19.82,108700,16.69
NYSE,ASA,2001-12-27,20.0,20.2,19.7,20.2,59500,17.01
NYSE,ASA,2001-12-26,20.2,20.21,19.9,20.09,53400,16.91
NYSE,ASA,2001-12-24,20.25,20.25,20.15,20.24,14900,17.04
NYSE,ASA,2001-12-21,20.35,20.35,20.1,20.34,61400,17.12
NYSE,ASA,2001-12-20,20.1,20.31,20.1,20.21,46200,17.01
NYSE,ASA,2001-12-19,20.35,20.49,19.9,20.23,88100,17.03
NYSE,ASA,2001-12-18,20.38,20.6,20.19,20.6,125900,17.34
NYSE,ASA,2001-12-17,20.4,20.5,20.2,20.4,76900,17.17
NYSE,ASA,2001-12-14,19.76,20.73,19.76,20.5,167300,17.26
NYSE,ASA,2001-12-13,19.34,19.83,19.33,19.7,55300,16.58
NYSE,ASA,2001-12-12,19.28,19.45,19.0,19.35,62000,16.29
NYSE,ASA,2001-12-11,19.3,19.45,19.15,19.25,13800,16.21
NYSE,ASA,2001-12-10,19.45,19.45,18.95,19.4,29200,16.33
NYSE,ASA,2001-12-07,19.74,19.74,19.4,19.45,31500,16.37
NYSE,ASA,2001-12-06,19.2,19.75,19.2,19.75,54200,16.63
NYSE,ASA,2001-12-05,19.35,19.4,18.92,19.25,72200,16.21
NYSE,ASA,2001-12-04,19.47,19.5,19.2,19.28,42600,16.23
NYSE,ASA,2001-12-03,19.8,19.84,19.55,19.72,59100,16.6
NYSE,ASA,2001-11-30,19.72,19.93,19.72,19.83,41400,16.69
NYSE,ASA,2001-11-29,20.0,20.1,19.72,19.72,49600,16.6
NYSE,ASA,2001-11-28,19.8,20.05,19.71,19.75,85000,16.63
NYSE,ASA,2001-11-27,19.05,19.7,19.05,19.7,63000,16.58
NYSE,ASA,2001-11-26,19.47,19.47,18.8,18.88,32200,15.89
NYSE,ASA,2001-11-23,18.97,19.25,18.97,19.25,54100,16.21
NYSE,ASA,2001-11-21,18.6,18.97,18.5,18.97,52600,15.97
NYSE,ASA,2001-11-20,18.1,18.55,18.1,18.55,21100,15.62
;;;;
run;


/* ------------------------------------------------------------------------- */
filename script "c:\temp\test.pig";
data _null_;
	file script;

	length long $1024;
	input;
	long = _infile_;
	long = tranwrd(long, '$USER$',  trim(left("&USER.")));
	long = trim(long);
	put long ' ';

cards4;
rmf /user/$USER$/AVG_AEG_stock_volume.tsv

NYSE   = LOAD '/user/$USER$/nyse.csv' USING PigStorage(',') AS 
	(exchange:chararray, stock_symbol:chararray, date:chararray, 
    stock_price_open:float, stock_price_high:float, stock_price_low:float, 
    stock_price_close:float, stock_volume:int, stock_price_adj_close:float);

AEG    = filter NYSE by stock_symbol == 'AEG'; 
GRP    = group AEG all;
AVGAEG = foreach GRP generate AVG(AEG.stock_volume);

store AVGAEG into '/user/$USER$/AVG_AEG_stock_volume.tsv'; 
;;;;
run;


/* ------------------------------------------------------------------------- */
proc hadoop /* options=cfg*/ username="&USER." verbose;   
    pig code=script;
run;
